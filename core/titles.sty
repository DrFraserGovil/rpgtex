\ExplSyntaxOn

\input{core/lowlevel/image_pages}

%%%% redefines appendices in TOC
\newcommand\tocchapapp{}
\g@addto@macro\appendix{%
\addtocontents{toc}{\protect\renewcommand{\protect\@chapapp}{Appendix}}%
\addtocontents{toc}{\protect\renewcommand{\protect\tocchapapp}{Appendix}}%
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Part pages (with images)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%% internal arguments defined in core/lowlevel/image_pages.tex
\RenewDocumentCommand{\part}{s o m }
{
	\bool_if:NTF{#1}
	{ %%starred version uses the underlying class part
		\__rpg_orig_part{#3}
	}
	{
		\bool_if:NTF{\str_if_eq_p:nn{#2}{none}}
		{ %%use default version if optional argument = 'none'
			\__rpg_orig_part{#3}
		}
		{
			%%otherwise use the custom theme part (RpgDrawPartPage), with or without a background image
			\__custom_part_page:nn{#2}{#3}
		}
	}
}


\NewDocumentCommand{\RpgSetPartPage}{+m}
{
	\cs_set:Nn \l__rpg_draw_part_page:n{#1}
}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Title pages (with images)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%Add new commands in vein of \title, \author etc.
\NewDocumentCommand{\subtitle}{m}
{
	\gdef\@subtitle{#1}
}
\NewDocumentCommand{\cover}{m}
{
	\gdef\@cover{#1}
}

%set default values to blank
\subtitle{} 
\cover{}

%%%%%%%%%%%%%%%% %%%%%%%%%%%%%%
%Commands called by \maketitle
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

%%%Used for books, similar ot part page, draws the contents of this macro over the top of the background image specified by \@cover
\NewDocumentCommand\RpgSetTitleCover{+m}
{
	\cs_set:Nn \l__rpg_draw_cover_page:{#1}
}

%%%Used for articles, a lightweight, text-only title. Not rendered within a tikzpicture.
\NewDocumentCommand\RpgSetTitleHeader{+m}
{
	\cs_set:Nn \l__rpg_simple_title:{#1}
}

%%Switching command used by classes to choose to use a full-page drawn title, or a simple text title

\NewDocumentCommand{\RpgSetTitleMode}{m}{
	\str_case:enF{#1}
	{
		{cover} {\bool_set_true:N \g__rpg_use_cover_page_bool}
		{header} {\bool_set_false:N \g__rpg_use_cover_page_bool}
	}
	{
		\msg_new:nnn{rpg}{bad-cover-set}{Title~mode~input~must~be~(header/cover),~not~'#1'}
		\msg_error:nnn{rpg}{bad-cover-set}{#1}
	}
}

\ExplSyntaxOff
