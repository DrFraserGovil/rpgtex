\ExplSyntaxOn


\msg_new:nnn { rpg } { bad_bool } {Could~not~set~boolean~variable~#1~from~value~'#2'}


\cs_new_protected:Npn \__rpg_set_bool_from_text:Ne#1#2{
	\str_case:nnF {#2}
	{
		{true} {\bool_set_true:N#1}
		{True} {\bool_set_true:N#1}
		{1} {\bool_set_true:N#1}
		{false} {\bool_set_false:N#1}
		{False} {\bool_set_false:N#1}
		{0} {\bool_set_false:N#1}
	}
	{
		\msg_error:nnxx { rpg } { bad_bool } { #1 }{#2}
	}
}

\cs_new_protected:Npn \__rpg_bool_from_text:e#1{
	\str_case:nnF {#1}
	{
		{true} {\c_true_bool}
		{True} {\c_true_bool}
		{1} {\c_true_bool}
		{false} {\c_false_bool}
		{False} {\c_false_bool}
		{0} {\c_false_bool}
	}
	{
		\msg_error:nnxx { rpg } { bad_bool } {}{#1}
	}
}


\cs_new_protected:Npn \__rpg_insert_tl_key:xene #1#2#3#4
{
	\exp_args:Ne\keys_define:nn{#1}{
    #2 .tl_set:N = #3,
    #2 .initial:n = {#4},
    #2 .value_required:n = true
	}
}

\msg_new:nnn { rpg } { bad-key-add } {Cannot~add~key~'#1'~without~specifying~group.}
\cs_new_protected:Npn \__rpg_tl_key:nnn #1#2#3
{
	\tl_if_empty:NT\l__current_group_tl
	{
		\msg_error:nnn { rpg } { bad-key-add } {#1}
	}
	\__rpg_insert_tl_key:xene {\l__current_group_tl}{#1}{#2}{#3}
}

\tl_new:N \l__current_group_tl
\cs_new_protected:Npn \__rpg_add_tl_keys:Nn#1#2
{
	
	\tl_gset:Nn \l__current_group_tl {#1}
	#2
	\tl_gset:Nn \l__current_group_tl {}
}
