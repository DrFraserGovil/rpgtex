% \ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Dependencies
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Helps prevent option clash with other packages that include xcolor
\PassOptionsToPackage {table} {xcolor}

\RequirePackage {array}
\RequirePackage {colortbl}
\RequirePackage {enumitem}
\RequirePackage {etoolbox}
\RequirePackage {hang} % hanging paragraphs
\RequirePackage {tabularx} % variable-width table columns
\RequirePackage [breakable,skins,xparse]{tcolorbox} % styled text boxes
\RequirePackage {tikz} % drawing ornaments and lines
\RequirePackage {xcolor}
\RequirePackage {xparse} % \NewDocumentCommand and expl3
\RequirePackage[hidelinks] {hyperref}

\sys_if_engine_luatex:T
  {
    \RequirePackage {luacolor}
  }


%% force layout changes -- but only if layout option triggered by class
\bool_if:NT \l__rpg_layout_bool
  {
    \RequirePackage {geometry}
    \RequirePackage {microtype} % Improve ragged2e hyphenation and overfull boxes
    \RequirePackage {ragged2e}
    \RequirePackage [titles] {tocloft} % multi-column toc
    \RequirePackage [newparttoc] {titlesec}  % Used to adjust (sub)section, part, and table of contents formatting

    \bool_if:NT \l__rpg_multitoc_bool
      { \RequirePackage [toc] {multitoc} }

    % Set page geometry.
    \geometry
      {
        hmargin   = .65in, % Left and right margins
        top       = .4in, % Top of text area to top of page
        bottom    = .75in,  % Bottom of text area to bottom of page
        footskip  = .3in, % Bottom of text area to bottom of footer text
        columnsep = .25in, % Space between columns
      }

    % Set paragraph and line spacing
    \setlength {\parindent}            {1em}
    \setlength {\RaggedRightRightskip} {0pt plus 1em}
    \setlength {\RaggedRightParindent} {\parindent}

    % Restrict hyphenation
    \tolerance        = 1
    \emergencystretch = \maxdimen
    \hyphenpenalty    = 10000
    \hbadness         = 10000

    % Set left justification if not justified
    \bool_if:NF \l__rpg_justified_bool
      { \RaggedRight }

    % Customize itemize environment.
    \setlist{leftmargin=1em}
    \setitemize{noitemsep,topsep=0.5ex,label=\footnotesize{\textbullet}}
  }

% % % Load other modules of this package after all dependencies to avoid load order
% % % conflicts (e.g., package options).
% % % Low-level modules first.
\RequirePackage {core/rpgutility}   % utility functions
\RequirePackage {core/rpgcolors}	% color definitions
\RequirePackage {core/rpgfonts}	    % font definitions


% % % Main modules in alphabetical order
\RequirePackage {core/rpgtip}    % inline tip boxes
\RequirePackage {core/rpgheader}     % fancy headers and footers
% % \RequirePackage {lib/rpgmonster}    % stat blocks
% % \RequirePackage {lib/rpgreadaloud}  % read-aloud text
\RequirePackage {core/rpgmap}   % section styling and special section headers
\RequirePackage {core/rpgsections}   % section styling and special section headers
% % \RequirePackage {lib/rpgsidebar}    % sidebars
% % \RequirePackage {lib/rpgtable}      % tables
\RequirePackage {core/rpgtoc}        % table of contents styling
