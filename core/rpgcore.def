% \ExplSyntaxOn

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
% Package Dependencies
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% Helps prevent option clash with other packages that include xcolor
\PassOptionsToPackage {table} {xcolor}

\RequirePackage {array}
\RequirePackage {colortbl}
\RequirePackage {enumitem}
\RequirePackage {etoolbox}
\RequirePackage {hang} % hanging paragraphs
\RequirePackage {tabularx} % variable-width table columns
\RequirePackage [breakable,skins,xparse]{tcolorbox} % styled text boxes
\RequirePackage {tikz} % drawing ornaments and lines
\RequirePackage {xcolor}
\RequirePackage{float}
\RequirePackage [titles] {tocloft} % multi-column toc
\RequirePackage [newparttoc] {titlesec}  % Used to adjust (sub)section, part, and table of contents formatting
\RequirePackage{titletoc}
\RequirePackage{fancyhdr}
\RequirePackage{dblfloatfix}
\RequirePackage {xparse} % \NewDocumentCommand and expl3
\RequirePackage[hidelinks] {hyperref}

\ExplSyntaxOff
\usetikzlibrary{calc}
\ExplSyntaxOn

\sys_if_engine_luatex:T
  {
    \RequirePackage {luacolor}
  }


%% force layout changes -- but only if layout option triggered by class
\bool_if:NT \l__rpg_layout_bool
  {
    \RequirePackage {geometry}
    \RequirePackage {microtype} % Improve ragged2e hyphenation and overfull boxes
    \RequirePackage {ragged2e}

    \bool_if:NT \l__rpg_multitoc_bool
      { \RequirePackage [toc] {multitoc} }

   
    

    % Restrict hyphenation
    \tolerance        = 1
    \emergencystretch = \maxdimen
    \hyphenpenalty    = 10000
    \hbadness         = 10000

    % Set left justification if not justified
    \bool_if:NF \l__rpg_justified_bool
      { \RaggedRight }

    % Customize itemize environment.
    \setlist{leftmargin=1em}
    \setitemize{noitemsep,topsep=0.5ex,label=\footnotesize{\textbullet}}
  }

% % % Load other modules of this package after all dependencies to avoid load order
% % % conflicts (e.g., package options).
% % % Low-level modules first.
\input{core/lowlevel/internal_utility} %% provides some general expl3 macros we use in multiple places

\RequirePackage {core/utility}   % utility functions
\RequirePackage {core/colors}	% color definitions
\RequirePackage {core/fonts}	    % font definitions

% % % Main modules in alphabetical order
\RequirePackage {core/colorboxes}    % inline tip, narration and sidebar boxes
\RequirePackage {core/map}   % section styling and special section headers
\RequirePackage {core/table}      % tables
\RequirePackage {core/titles}
\RequirePackage {core/headerdecorations}     % fancy headers and footers
\RequirePackage{core/card}
%
 % %% packages which do nothing but alter geometry/page settings, and so are ignored if the header layout setting is not active
\RpgLayoutOnly{
	\RequirePackage {core/sections}   % section styling and special section headers
	\RequirePackage {core/toc}        % table of contents styling
}
