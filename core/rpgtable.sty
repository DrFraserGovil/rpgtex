\ExplSyntaxOn

\input{core/lowlevel/table}

% Table Definition
\NewDocumentEnvironment {RpgTable} { o m }
{
	\group_begin:

	\keys_set:nn {rpg/table}{width=\linewidth}
	\tl_if_novalue:nF {#1}
	{ 
		\keys_set:nn { rpg / table } {#1} 
	}

  	\par \vspace { 9pt plus 3pt minus 3pt } \noindent

 
	\__write_table_header:n {\l__rpg_table_header_tl}
  
	\RpgFontTableBody

  \rowcolors {1} {} {\l__rpg_table_color_tl}

  \regex_extract_all:NnNTF \c__preamble_regex {#2} \l_tmpa_seq
  {
    \tl_set:Nn \l_tmpa_tl {\seq_use:Nn \l_tmpa_seq {^}}
    \use:x { \exp_not:n {\tabularx{\l__rpg_table_width_dim}}{`\l_tmpa_tl}}
    \rowstyle{\RpgFontTableHeader}
  }
  {
    \tabularx {\l__rpg_table_width_dim} {#2}
  }

}
{
  \endtabularx \vspace { 9pt plus 3pt minus 3pt }

  \group_end:
}
