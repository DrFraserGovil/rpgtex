\ExplSyntaxOn

\input{core/lowlevel/table}
\RequirePackage{supertabular}
% Table Definition
\NewDocumentEnvironment {RpgTable} { O{} m +b}
{
	\group_begin:
	\keys_set:nn {rpg/table}{width=\linewidth}
	\keys_set_known:nnN { rpg / table } {#1} {\l_tmpa_tl}


  	\par \vspace { \l__table_vskip } \noindent

	\bool_if:NT{\l__rpg_table_filigree_bool}
	{
		\tl_set:Nf \l_tmpb_tl { \begin{RpgFiligree} [ \l_tmpa_tl ] }
		\l_tmpb_tl
			\noindent
	}
	\__write_table_title:n {\l__rpg_table_header_tl}
  
	\bool_if:NTF {\l__rpg_table_simple_bool}
	{
		\__simple_table:nn {#2}{#3}	
	}
	{
		\bool_if:NTF {\l__rpg_table_breakable_bool}
		{
			\__fancy_table:nnn {xltabular}{#2}{#3}	
		}
		{
			\__fancy_table:nnn {tabularx}{#2}{#3}
		}
	}
}
{
	\bool_if:NT{\l__rpg_table_filigree_bool}
	{
		\end{RpgFiligree}
	}
	\vspace { \l__table_vskip }
  	\group_end:
}
