\ExplSyntaxOn

\input{core/lowlevel/table}
\RequirePackage{supertabular}
% Table Definition
\NewDocumentEnvironment {RpgTable} { o m +b}
{
	\group_begin:
	\keys_set:nn {rpg/table}{width=\linewidth}
	\tl_if_novalue:nF {#1}
	{ 
		\keys_set:nn { rpg / table } {#1} 
	}


  	\par \vspace { \l__table_vskip } \noindent

	\bool_if:NT{\l__rpg_table_filigree_bool}
	{
		\begin{RpgFiligree}[opacityback=\l__rpg_table_filigree_opacity]\noindent
	}
	\__write_table_title:n {\l__rpg_table_header_tl}
  
	\bool_if:NTF {\l__rpg_table_simple_bool}
	{
		\__simple_table:nn {#2}{#3}	
	}
	{
		\bool_if:NTF {\l__rpg_table_breakable_bool}
		{
			\__fancy_table:nnn {xltabular}{#2}{#3}	
		}
		{
			\__fancy_table:nnn {tabularx}{#2}{#3}
		}
	}
}
{
	\bool_if:NT{\l__rpg_table_filigree_bool}
	{
		\end{RpgFiligree}
	}
	\vspace { \l__table_vskip }
  	\group_end:
}
