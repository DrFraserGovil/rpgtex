
\ExplSyntaxOn


\NewDocumentCommand{\RpgCreateNewCardFormat}{m m m}
{
	%%%%Initialise the hooks to the internal formatters
		\cs_new:cpn {__#1_card_format:nn}{-No-Format-Set-For-#1-Card-}
		\cs_new:cpn {__#1_text_format:nn}{-No-Format-Set-For-#1-Text-}

		\cs_new:cpn {#1SetCardFormat} ##1
		{
			\cs_set:cn {__#1_card_format:nn} {##1}
		}
		\cs_new:cpn {#1SetTextFormat} ##1
		{
			\cs_set:cn {__#1_text_format:nn} {##1}
		}
	%%Define default formatter values
		\use:c{#1SetCardFormat}{\subsection{##1} ##2\par \vfill}
		\use:c{#1SetTextFormat}{\subsection{##1} ##2\par}

	%%Define the attribute list
		\cs_new:cpn {#1AddProperty} ##1##2##3
		{
			\__rpg_insert_tl_key:xene{rpg/card/#3}{##1}{##2}{##3}   
		}


	%%Individual environments
	\NewDocumentEnvironment{__#1Card}{O{} m +b}
	{
		\begin{RpgCard}[##1]
			\use:c{__#1_card_format:nn}{##2}{##3}
	}
	{
		\end{RpgCard}
	}
	\NewDocumentEnvironment{__#1Text}{m +b}
	{
		\use:c{__#1_text_format:nn}{##1}{##2}
	}{}

	\RpgSetSwitch{#2}{false}
	
	%%Now define the actual switchenv wrapper
	\NewDocumentEnvironment{#1}{O{} m O{}}
	{
		 \keys_set:nn{rpg/card/#3}{##3}
		\begin{RpgSwitchEnv}{#2}[##1]{__#1Card}{__#1Text}{##2}
	}{
		\end{RpgSwitchEnv}
	}

	
}

\RpgCreateNewCardFormat{RpgItem}{UseItemCard}{item}

% \cs_new:Npn \__rpg_item_card_format:nn#1#2{\subsection{#1} #2}
% \cs_new:Npn \__rpg_item_text_format:nn#1#2{\subsection{#1} #2}

% \NewDocumentEnvironment{__RpgItemCard}{O{} m +b}{
%     \begin{RpgCard}[#1]

%         \__rpg_item_card_format:nn{#2}{#3}
        
% }{
%     \end{RpgCard}
% }

% \NewDocumentCommand{\RpgAddItemProperty}{m m m}{
%     \__rpg_insert_tl_key:xene{rpg/item}{#1}{#2}{#3}   
% }

% \NewDocumentEnvironment{__RpgItemText}{m +b}{
%     \__rpg_item_text_format:nn{#1}{#2}
% }{}

% \NewDocumentCommand{\RpgSetItemCardFormat}{+m}{
%     \cs_set:Nn \__rpg_item_card_format:nn{#1}
% }
% \NewDocumentCommand{\RpgSetItemTextFormat}{+m}{
%     \cs_set:Nn  \__rpg_item_text_format:nn{#1}
% }

% \NewDocumentCommand{\RpgUseItemCards}{m}{
%     \RpgSetSwitch{UseItemCard}{#1}
% }
% \RpgUseItemCards{false}
% \NewDocumentEnvironment{RpgItem}{O{} m O{}}{
%     \keys_set:nn{rpg/item}{#3}
%     \begin{RpgSwitchEnv}{UseItemCard}[#1]{__RpgItemCard}{__RpgItemText}{#2}
% }{
            
%     \end{RpgSwitchEnv}
% }

\ExplSyntaxOff
