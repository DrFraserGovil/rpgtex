
\RpgSetSwitch{ShowSecrets}
\ExplSyntaxOn
% Define a custom tcolorbox style for the dual-block structure
\tcbset{
    dualtitleboxstyle/.style = {
        standard~jigsaw, %for transparency
        opacityback=0, 
        %%set dimensions -- skinny and lightweight so doesn't interrupt text too much
        boxrule=1pt,
        left=2pt,
        right=2pt,
        top=2pt,
        bottom=2pt,
    }
}

%just prints the (optional) 'lie' text, doesn't print the body contents!
\NewDocumentEnvironment{__RpgSecretHide}{m +b}{
    #1
}{}

%%puts the secret text into a tcolorbox, and if a 'lie' is present, put that in too so the GM knows both sides of the story
\NewDocumentEnvironment{__RpgSecretShow}{m +b}{
    \tl_if_blank:eTF{#1}
    {
        
        \begin{tcolorbox}[
            dualtitleboxstyle,
            colframe=\l__rpg_secret_color_tl
        ]
        {\RpgFontSecretTitle \l__rpg_secret_secret_title_tl}\par 
        #2

    }
    {
        \begin{tcolorbox}[
            dualtitleboxstyle,
            sidebyside,
            sidebyside~align=top,
            sidebyside~gap=0.4cm,
             colframe=\l__rpg_secret_color_tl
        ]
        {\RpgFontSecretTitle \l__rpg_secret_public_title_tl}\par
        
        #1
        \tcblower
         {\RpgFontSecretTitle \l__rpg_secret_secret_title_tl}\par
        #2
        
    }

}{
        \end{tcolorbox}
}

%%Some user-customisation
\__rpg_add_tl_keys:Nn{rpg/secret}
{
    \__rpg_tl_key:nnn {title-public}{\l__rpg_secret_public_title_tl}{Normal~text}
    \__rpg_tl_key:nnn {title-secret}{\l__rpg_secret_secret_title_tl}{Secret~text}
    \__rpg_tl_key:nnn {color}{\l__rpg_secret_color_tl}{gray!50}
}  


\NewDocumentEnvironment{RpgSecret}{O{} m}{
    \keys_set:nn{rpg/secret}{#1}
    \begin{RpgSwitchEnv}{ShowSecrets}{__RpgSecretShow}{__RpgSecretHide}{#2}
}{
    \end{RpgSwitchEnv}
}

\NewDocumentCommand{\RpgShowSecrets}{m}
{
    \RpgSetSwitch{ShowSecrets}{#1}
}
\ExplSyntaxOff
