
\usepackage{xltabular}
\usepackage{listings}
\lstset{
  basicstyle=\ttfamily,
  columns=fullflexible, % Uses the actual font width (best match for \verb)
  flexiblecolumns=true, % Allows for variable-width fonts (important for \ttfamily)
  breaklines=true,
  breakatwhitespace=true,
  showtabs=false,
  tabsize=1,
}
\usepackage{makecell}
\usepackage{adjustbox}

\newcommand\kve[3]{\texttt{#1} & #2 & #3\\}
\newcommand\labelsection[1]
{
	\section{#1}\label{S:#1}
}

\ExplSyntaxOn{}
\usepackage{lstautogobble}
\newcommand\DualExampleRender[1]
{
	\noindent\begin{minipage}[t]{0.5\linewidth}\small 
		\noindent\lstinputlisting{parts/examples/#1}
	\end{minipage}\begin{minipage}[t]{0.5\linewidth}
		\input{parts/examples/#1}
	\end{minipage}
	}
	
\definecolor {backred}{HTML}{802020}
\tcbuselibrary{listings,hooks}

\lstdefinestyle{example}
{
	language=TeX,
	basicstyle=\ttfamily\small,
	showstringspaces=false,
	breaklines=true,
	
	% --- Styles ---
	texcsstyle=*\color{blue}\bfseries, 
	keywordstyle=\color{purple}\bfseries,
	commentstyle=\color{green!60!black}\itshape,
	stringstyle=\color{red},
	
	% --- ExplSyntax Compliant Keyword Lists ---
	% Spaces must be replaced with the tilde (~) character.
	texcs={
		documentclass, usepackage, input, section, subsection, 
		tcbset, newcommand, newenvironment, 
		ExplSyntaxOn, ExplSyntaxOff , newfontfamily,
		document,
		tikzpicture,
		tcolorbox,
		lstlisting,
		newtcolorbox,
		begin,end
	},

	

	framexleftmargin=0pt,
	
	framexbottommargin=0pt,
	breakindent=1em,
	aboveskip=0pt,
	belowskip=0pt,
	framesep=0pt,
	boxpos=t
}

\newtcblisting{exampleInternal}[1]{

        listing~style={example},
		#1,
		% colframe=themecolor!80!black,
        % colback=gray!10,
		colframe=gray!50,colback=black!10!white,
		enhanced~jigsaw,
		opacityback=0.6,
		opacityframe=1,
		boxrule=1.5pt,arc=1mm,
		titlerule=2pt,
		left=0pt,
		top=0pt,
		bottom=0pt,
		 attach~boxed~title~to~top~left=
		{yshift=-\tcboxedtitleheight/2},
		coltext=black,
		boxed~title~style={coltext=black,size=small,colback=black!10!white,coltext=red},
    % title={hi},
	
}

\NewDocumentEnvironment{ExampleBlock}{O{} O{listing~side~text} m}
{
	\tl_if_empty:eTF{#3}{
		\exampleInternal{
			listing~options={style={example},keywords={#1},framextopmargin=0pt,},
			top=0pt,
			% top=-8pt,
			% bottom=-8pt,
			#2
		}
	}{
		\exampleInternal{
			title={\color{black}#3},
			listing~options={style={example},keywords={#1},framextopmargin=15pt},
			% bottom=-8pt,
			#2,
			
		}
	}
}
{
	\endexampleInternal
}

\newtcblisting{BashBlock}[1][bash]{

        listing~options={
            language=bash, % The correct, non-error-producing language
            showstringspaces=false,
            breaklines=true,
        },
		colframe=backred,
        colback=gray!10,
       boxrule=1pt,
    	listing~only,
		colframe=gray!50,colback=black!10!white,
		 left=2pt,right=2pt, 
		  top=1pt,bottom=1pt,    arc=1mm,enhanced,
		  title=#1,
		  attach~boxed~title~to~top~left=
{yshift=-\tcboxedtitleheight/2},
boxed~title~style={size=small,colback=gray!80}

}

\def\NoArgs{\{\}}

\def\bs{\textbackslash}


\NewDocumentCommand{\BeginMacroFormat}{}
{
	
	\newgeometry
	{
		right   = .65in, % Left and right margins
		left	= 3cm,
		top       = .4in, % Top of text area to top of page
		bottom    = .75in,  % Bottom of text area to bottom of page
		footskip  = .3in, % Bottom of text area to bottom of footer text
		columnsep = .25in, % Space between columns
		}
		\onecolumn
}



\NewDocumentCommand{\lMacro}{m}{
	\texttt{\textbackslash\_\_#1}
}


\NewDocumentCommand{\cmd}{m}
{
	\texttt{\textbackslash#1}
}
\NewDocumentCommand{\param}{m}
{
	\{#1\}
}
\NewDocumentCommand{\paramO}{}
{
	O\param{}
}
\cs_new_protected:Npn \__rpg_doc_macro_list:nn #1#2
{
	\clist_map_inline:nn { #1, #2 }
	{
	\maxsizebox{2.49cm}{3cm}{\tt##1} \\
	}
}

\NewDocumentEnvironment{Code}{O{}}
{
	\begin{tcolorbox}[colframe=gray!50,colback=black!10!white,boxsep=0pt, left=2pt,right=2pt,  top=5pt,bottom=4pt,    arc=1mm,#1]
			\tt %\color{white} 
}
{
	\end{tcolorbox}
}

\usepackage{amsmath}

\NewDocumentCommand\FFidx{m}
{
	\index{FeatureForge!#1}
	\index{RpgSpell!#1}
	\index{RpgFeat!#1}
	\index{RpgItem!#1}
	\index{RpgStatblock!#1}
}
\NewDocumentCommand{\RpgMacro}{s o m +m +m +m +m}{
	\IfBooleanTF{#1}
		{
			\label{#3}
		}
		{
			\label{Macro:#3}
		}

	\tl_if_novalue:nTF{#2}
	{
		\index{#3}
	}
	{
		\cmdidx{#2}
	}

	\hspace{-3.1cm}
	\begin{tcolorbox}[
			before~skip=0em,
			after~skip=1.5em,
		blanker,
		breakable,
		width=\linewidth,
		overlay~unbroken~and~first={%
		\node[inner~sep=0pt,outer~sep=0pt,text~width=3.1cm,
		align=right,anchor=east,
		below~right]
		at ([xshift=-3.5cm]frame.north~west)
		{
			\__rpg_doc_macro_list:nn{\IfBooleanTF{#1}{{#3}}{\cmd{#3}}}{#4}
		};}
  ]
		
		#5

		 \str_if_empty:nF{#6}
		{
			\begin{Code}#6\end{Code}
		}
		
		\str_if_empty:nF{#7}
		{
			% \subsection{Details}
			{#7}
		}

	\end{tcolorbox}
	% \vspace{-0.5em}
}

\NewDocumentCommand{\RpgMacroExample}{s o m +m +m +m +m}{
	\IfBooleanTF{#1}
		{
			\label{#3}
		}
		{
			\label{Macro:#3}
		}

	\tl_if_novalue:nTF{#2}
	{
		\index{#3}
	}
	{
		\cmdidx{#2}
	}

	\hspace{-3.1cm}
	\begin{tcolorbox}[
			before~skip=0em,
			after~skip=1.5em,
		blanker,
		breakable,
		width=\linewidth,
		overlay~unbroken~and~first={%
		\node[inner~sep=0pt,outer~sep=0pt,text~width=3.1cm,
		align=right,anchor=east,
		below~right]
		at ([xshift=-3.5cm]frame.north~west)
		{
			\__rpg_doc_macro_list:nn{\IfBooleanTF{#1}{{#3}}{\cmd{#3}}}{#4}
		};}
  ]
		
		#5

		 \str_if_empty:nF{#6}
		{
			\RpgGetExample{#6}
		}
		
		\str_if_empty:nF{#7}
		{
			% \subsection{Details}
			{#7}
		}

	\end{tcolorbox}
	% \vspace{-0.5em}
}


\usepackage{lipsum}
\usepackage{wrapfig}
\NewDocumentEnvironment{fontlist}{+b}{
	\vspace{1em}
	
    % \hspace{-1.5cm}
	\let\__rpg_colsep:&
	\noindent\begin{RpgTable}[breakable]{llX}
		Font~Element & Components & Usage \\
		#1
    \end{RpgTable}}{}

\NewDocumentCommand{\FontElement}{m +m +m}
	{
		\small\tt\cmd{#1}

		%%index
		\tl_set:Nx \l_tmpa_tl { \str_range:nnn {#1} {8} {-1} }
		% \index{RpgFont!\texttt{\l_tmpa_tl}}

		% \lowercase{\def\temp{\m}}
		% 	\expandafter\index\expandafter{\temp@\texttt{\textbackslash\m}}
		&
		\parbox[t]{4cm}{\tt {#2-family} \\ {#2-style} }
		&
		#3
		\\
	}


\newcommand{\code}[1]{\texttt{(\detokenize{#1})}}
\usepackage{verbatimbox}
\newcommand\tabverbExample[1]
{
	\verb|#1| &  #1 \\
}


	\tl_new:N \l__temp_dice
	\NewDocumentCommand{ \DndTempDiceFormat }{m m m}
	{
		% #1: Dice Number, #2: Dice Sides, #3: Modifier
		\tl_if_blank:VTF {#1}
		{
			% CASE: called without a dice count (i.e. d8), equal to 1d8
			\tl_set:Nn\l__temp_dice{1}
		}
		{
			\tl_set:Nn \l__temp_dice{#1}
		}
		\tl_set:Nn \l_tmp_mean_tl { \fp_eval:n {
				floor ( \tl_use:N{\l__temp_dice} * ( #2 + 1 ) / 2 ) + (#3)
			}}
			\l_tmp_mean_tl{}~(\l__temp_dice d#2
			\fp_compare:nNnTF { #3 } { = } { 0 }{}{#3})
	}


\cs_new:Nn \l_mypackage_F_code_tl:nnn
{
    \fbox{\color{gray} \itshape Default~Implementation:}~#1~|~#2~|~#3
}

% 2. Define the public interface command F{m m m}
\NewDocumentCommand{\executeF}{mmm}
{
    \l_mypackage_F_code_tl:nnn{#1}{#2}{#3}
}

\NewDocumentCommand{\SetupFCode}{m}
{
    % This command allows the theme designer to completely replace the code
    \cs_set:Nn \l_mypackage_F_code_tl:nnn {#1}
}

	\ExplSyntaxOff{}
