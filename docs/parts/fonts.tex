\chapter{Fonts}

	\rpgtex{} allows for a high degree of customisation of the fonts and typefaces used for the elements within a document. The key interface for the designer is the \verb|\RpgSetFont| command, which accepts a wide variety of key-value inputs, detailed below. 

	
	\section{Font Interface}\label{S:FontInterface}

		\begin{macrolist}
			\RpgMacro{\RpgSetFont,{{m}}}
			{\cmdidx{RpgSetFont}
				Saves new font values and styles to the internal RpgFont[X] variables, which are then available for themes to use.			
			}
			{
				\RpgSetFont{<key-value-pairs>}
			}{
				Note that this interface \textbf{does not automatically change all fonts}. The SetFont-interface saves values to internal variables which populate the corresponding \verb|RpgFont[X]| macros. It does not invoke \verb|fontspec| and does not automatically assign fonts to the designated elements. \textit{However}, a theme designer may then use the \verb|RpgFont[X]| macros within their commands, thereby assigning fonts to the relevant elements. In this case (or if a user manually invokes a font), this command will act to update the font.

				To summarise: if a writer uses a theme which does not make use of the \verb|RpgFontSection| font, then calling \verb|RpgSetFont{section-style=\it}| will have no effect. They would need to set \verb|\titleformat {\section}{ \RpgFontSection }{}{}| (titlesec is loaded by default), in which case calling \verb|RpgSetFont| would change the font for all subsequent calls to \verb|\section|.
				
				The exception to this is the main-body font, which is achieved by updating \verb|\normalfont|. 
			}
		\end{macrolist}

		\subsection{Defining Fonts}

			The arguments passed to the `style' can be any form of latex formatting (i.e. \verb|\slshape\scriptsize\bfseries|, and so on). To update the typeface, however, you must define a font family:
			\begin{lstlisting}
				\newfontfamily{\myfont}{arial}
				\RpgSetFont{main-body-family=\myfont}
			\end{lstlisting}

			For custom typefaces - or where you wish to `mix and match' typefaces in different modes, you can use the full power of the \forcelink{ctan.org/pkg/fontspec?lang=en}{fontspec package}:
			\begin{lstlisting}
				\newfontfamily{\myfont}{custom-font}[
					Path=/path/to/local/font.otf,
					ItalicFont=*-Bold,
					BoldFont=Arial,
				]
				\RpgSetFont{main-body-family=\myfont}
			\end{lstlisting}
			This would define a font which used a local .otf file for the main font, but the bold typeface when \verb|\textit{}| were called, and used arial as the mock `boldface'.

		\subsection{Font Elements}
			\rpgtex{} provides 28 Font Commands, each comprised of a \textit{family} and a \textit{style}. 
			\begin{RpgSidebar}{Family vs Style}
				When defining the Font for an element, the interface allows one to specify both a \texttt{family} and a \texttt{style}. Formally speaking, \texttt{family} defines the \textbf{typeface} used by the associated element, whilst the \texttt{style} determines the options passed to that typeface (bold, italics, size etc.).

				The distinction is largely irrelevant, as the construction of the final font object is often simply the concatenation of the two:
				\begin{lstlisting}
					\def\RpgFontX
					{
						\l__rpg_x_family \l__rpg_x_style
					}
				\end{lstlisting}
				The separate definitions is therefore largely a matter of clarity and readability. It is generally safe to place commands that should be in family into the style key, as long as it doesn't conflict with other styling.
				
				\vspace{1em}
				{\RpgFontSidebarTitle \noindent Font vs Implementation}

				We generally encourage designers to place all text visualisation within the relevant Font rather than elsewhere -- if all subsections are going to be in red, then define \verb|subsection-style=\color{red}|, rather than setting it within the titlesec specification (\verb|\titleformat {\subection}{\RpgFontSubsection\color{red}}....|).

				There will naturally be some exceptions to this: we found that the \verb|RpgTitleFont| colour we wanted within \verb|RpgDrawCover| diverged so strongly from that in \verb|RpgSimpleTitle| that it made sense to define a special colour when rendering over a background image.
			\end{RpgSidebar}

			These fonts are assigned to typesetting elements by the theme designer -- what we have intended to be the section font may, within a different theme, be used for a different element. This document outlines how we have used these elements in the provided themes, though this is not prescriptive.
			
			\begin{fontlist}
				\FontElement{\RpgFontBody}{main-body}{The main body text of the document, which \verb|RpgSetFont| sets equal to \verb|\normalfont|. 

				Updating the fontsize here (i.e. using \verb|\large|) can cause some counterintuitive results since it will \textit{only} update the body text, and not adjust the other elements relatively. Adjusting the font size for the entire document should be done in the documentclass declaration.
				}
				\FontElement{\RpgFontTitle}{title}{The font used for \verb|\@title| when \verb|\maketitle| is called.}
				\FontElement{\RpgFontSubtitle}{subtitle}{The font used for the value of \verb|\@subtitle| \RpgPage[p]{Macro:subtitle}, \verb|\@author| and \verb|\@date|  when \verb|\maketitle| is called.}
				\FontElement{\RpgFontPart}{part}{The font used when \verb|\part| is called.}
				\FontElement{\RpgFontTocPart}{toc-part}{The font used for a part in the table of contents}
				\FontElement{\RpgFontChapter}{chapter}{The font used when \verb|\chapter| is called.}
				\FontElement{\RpgFontTocChapter}{toc-chapter}{The font used for a chapter in the table of contents}
				\FontElement{\RpgFontSection}{section}{The font used when \verb|\section| is called.}
				\FontElement{\RpgFontTocSection}{toc-section}{The font used for a section in the table of contents}
				\FontElement{\RpgFontSubsection}{subsection}{The font used when \verb|\subsection| is called.}
				\FontElement{\RpgFontSubsubsection}{subsubsection}{The font used when \verb|\subsubsection| is called.}
				\FontElement{\RpgFontParagraph}{paragraph}{The font used when \verb|\paragraph| is called.}
				\FontElement{\RpgFontSubparagraph}{subparagraph}{The font used when \verb|\subparagraph| is called.}
				\FontElement{\RpgFontTableTitle}{table-title}{The font used for \verb|<text>| if \verb|\RpgTable| \RpgPage[p]{S:RpgTable} is called with the \verb|title=<text>| option.}
				\FontElement{\RpgFontTableHeader}{table-header}{The font used for the first row of a \verb|\RpgTable|.}
				\FontElement{\RpgFontTableBody}{table-body}{The font used for the text within an \verb|\RpgTable| after the first row.}
				\FontElement{\RpgFontTipTitle}{tip-title}{The font used for the title of an \verb|RpgTip| environment \RpgPage[p]{S:RpgTip}.}
				\FontElement{\RpgFontTipBody}{tip-body}{The font used for the body of an \verb|RpgTip| environment \RpgPage[p]{S:RpgTip}.}
				\FontElement{\RpgFontSidebarTitle}{siderbar-title}{The font used for the title of an \verb|RpgSidebar| environment \RpgPage[p]{S:RpgSidebar}.}
				\FontElement{\RpgFontSidebarBody}{sidebar-body}{The font used for the body of an \verb|RpgSidebar| environment \RpgPage[p]{S:RpgSidebar}.}
				\FontElement{\RpgFontNarration}{narration}{The font used for all (since they have no title) of an \verb|RpgNarration| environment \RpgPage[p]{S:Narration}.}

				\FontElement{\RpgStatBlockTitle}{stat-block-title}{The font used for the title of a `statblock' environment - in the dnd theme this corresponds to the \verb|monster| environment.}
				\FontElement{\RpgStatBlockSection}{stat-block-section}{The font used for sections within a `statblock' environment (should one be defined).}
				\FontElement{\RpgStatBlockBody}{stat-block-body}{The font used for text within a `statblock' environment (should one be defined).}
				\FontElement{\RpgFontFooter}{footer}{The font used for the footer text}
				\FontElement{\RpgFontPageNumber}{page-number}{The font used for the page number within the footer}
				\FontElement{\RpgFontDropCap}{drop-cap}{The font used for the large drop-cap letter created by a \verb|RpgDropCap| (see below).}
				\FontElement{\RpgFontDropCapInternal}{drop-cap-internal}{The font used for the first line of text following the drop cap.}
			\end{fontlist}

			\newpage
	\section{Decorative Text}
		In addition to the fundamental typeface alterations \rpgtex{} includes a number of commands to turn text into decorative elements.
		\begin{macrolist}
			\RpgMacro{\RpgContour,{{O{} m}}}
				{	\cmdidx{RpgContour}
					Renders text with a \RpgContour[inner=red,outer=black]{contour effect}. The color and style are set through key/value pairs.
				}
				{
					\RpgContour[inner=<color>,outer=<color>,style=<code>]{<text>}
				}
				{
					The \texttt{style} command is applied to the text, whilst the optional \texttt{inner} and \texttt{outer} commands set the base text colour and the external contour color respectively. If the colors are not set, the default values are the \verb|contourinnercolor| and \verb|contouroutercolor| values defined by the theme \RpgPage[p]{S:Colors}.
					
					The contour does not automatically linebreak, but can be controlled manually with a \verb|\newline| command (not \verb|\\| or \texttt{\textbackslash{}par})
					
					\begin{RpgTable}{lX}
						Example & Output \\
						\tabverbExample{\RpgContour[inner=red,outer=black]{example}}
						\tabverbExample{\RpgContour[style=\Huge\it]{example}}
						\tabverbExample{\RpgContour[]{multi\newline line\newline example}}
					\end{RpgTable}					
					~\macrosection{Quirks}

					Due to the tokenisation required for the line-splitting and space-preservation, the text inside the contour can exhibit some quirks if stylisation is applied within the \verb|<text>| argument. 

					Unbraced commands (such as \verb|\it| or \verb|\footnotesize|) will only apply to the first word in the text. Braced commands \textit{can} work, but will cause a compilation error if a \verb|\newline| is included. 

					
					\begin{RpgTable}{lX}
						\footnotesize\tabverbExample{\RpgContour[]{\Huge\it only first word changes}}
						\footnotesize\tabverbExample{\RpgContour[]{\textit{all words change}}}
						\footnotesize\verb|\RpgContour[]{\textit{all word \newline change}}| & (fails to compile)
					\end{RpgTable}
					For robustness, we therefore recommend that all stylisation be applied through the \verb|style| command, which is applied to each tokenised element, and therefore guaranteed to work as expected.
				}
			\RpgMacro{\RpgDropCap,{{O{}, m m}}}
				{	\cmdidx{RpgDropCap}
					Creates a decorative `drop cap' letter to begin a new chapter with, and modifies the following text.}{
					\RpgDropCap[<lettrine-args>]{<letter>}{<text>}
				}{
					This command uses \forcelink{https://texdoc.org/serve/lettrine/0}{the lettrine package} and the \forcelink{https://ctan.org/pkg/magaz?lang=en}{magaz} package to create an easy-to-use environment in which the first letter is enlarged (and stylised in the \verb|RpgFontDropCap|\index{Font!DropCap} font). The second argument formats \textit{up to the first line} of text in the \verb|RpgFontDropCapInternal|\index{Font!DropCapInternal} font (usually a simple \verb|scshape| command).

					This command can be a little fragile -- lettrine does not usually play well with the `FirstLine' command provided by magaz -- and we've used a few workarounds to allow both linebreaking, and the formatting of only the first line of text. There may need to be a small amount of manual calibration, but it is better than the default.					

					\begin{RpgTable}{lX}
						Example & Output \\
						\tabverbExample{\RpgDropCap{A}{n example: \blindtext}}
					\end{RpgTable}
				}
		\end{macrolist}


