\RpgSetTheme{dnd}
\chapter{\texttt{dnd} Theme}\label{Theme:dnd}

    The \texttt{dnd} theme is designed to mimic the Appearance of the \textit{Dungeons \& Dragons} source books. The specific parameters used to replicate the D\&D books are mostly derived from the original DnD-5e-Latex-Template package, with some additional updates in line with the changes made with the 2024 rules update.

    \section{Appearance}
        \subsection{Fonts}
            The dnd theme defines a number of font families which are used throughout the theme.
            
            \RpgMacro{bookman}{}{The {Bookman Old Style STd} typeface, used as the main body text.}{}{}{}
            \RpgMacro{keplerserif}{}{\keplerserif The {KpRoman} font, used for \textbf{emphasis}}{}{}{}
            \RpgMacro{kepler}{}{\kepler The {KpSans} font, primarily used in headers and titles}{}{}{}
            \RpgMacro{gillius}{}{\gillius The Gillius ADF No. 2 Font, used as a lighter sans-serif font, often in the body of environments where \cmd{kepler} was used as the title.}{}{}{}
            \RpgMacro{Royal}{}{{\Royal A DECORATIVE FONT}, unsuited for blocks of text. Used for drop-caps}{}{}

             The values assigned to the font elements areas follows (note that \verb|\normalfont| is aliased to the value of RpgFontBody).

            \InsertFontTable{
                main-body-family			={\bookman},
                %Sections
                title-family=		{\normalfont},
                title-style			= {\bfseries\fontsize{30}{50}\selectfont\color{titlered}},
                subtitle-family		={\scshape},
                subtitle-style 		= {\LARGE\color{titlered} },
                part-style			= {\color{titlered}\fontsize{50}{30}\selectfont},
                chapter-style		= {\titlemode\fontsize{30}{50}\selectfont},
                section-family		={\keplerserif \scshape},
                section-style		= {\color{titlered} \Huge},
                subsection-family		={\keplerserif \scshape},
                subsection-style	= {\color{titlered} \huge},
                subsubsection-family		={\keplerserif \scshape},
                subsubsection-style	= {\color{titlered} \Large},
                paragraph-style	= {\bfseries \slshape},
                subparagraph-style	= {\bfseries \slshape},
                %Tables
                table-title-family	= {\kepler},
                table-title-style	= {\bfseries\large\scshape},
                table-header-family	= {\kepler},
                table-body-family	= {\gillius},
                %tip boxes
                tip-title-family= {\kepler},
                tip-title-style	= {\bfseries\scshape},
                tip-body-family	= {\gillius},
                tip-body-style	= {\small},
                %sidebars
                sidebar-title-family= {\kepler},
                sidebar-title-style	= {\bfseries\scshape},
                sidebar-body-family	= {\gillius},
                sidebar-body-style	= {\small},
                %narration
                narration-family	= {\gillius},
                narration-style		= {\small},
                % TOC
                toc-part-style		= {\LARGE \keplerserif \scshape \color{titlered}},
                toc-chapter-style	= {\Large \keplerserif \scshape \color{titlered}},
                toc-section-style	= {\normalsize},
                %stat block
                stat-block-title-style= {\bfseries\scshape \LARGE},
                stat-block-body-family={\gillius},
                stat-block-body-style={\small},
                stat-block-section-family={\kepler},
                stat-block-section-style={\color{titlered} \scshape \large},
                %%misc
                footer-style		= {\color{pagegold}\scriptsize},
                page-number-style	= {\color{pagegold}\scriptsize},
                drop-cap-family		= {\Royal},
                %%Spell card
                card-title-family = {\keplerserif},
                card-title-style = { \color{titlered}\large\bfseries},
                card-header-family = {\normalfont}, 
                card-header-style = {\normalfont \scshape \footnotesize}, 
                card-body-family = {\normalfont},
                card-body-style = {\small},
                emph-family = {\keplerserif},
                emph-style = {\bfseries\scshape\larger[1]},
            }
            
        \subsection{Colors}

            The theme provides a large number of colors:

            \noindent\DefaultSwatches{}

            \noindent\ignorespaces\Swatch[default narration]{bgtan}
            \Swatch[pagenumbers \& footer]{pagegold}
            \Swatch[title font \& default contour-inner]{titlered}
            \Swatch[default contour-outer]{contourgray}
            \Swatch[title rules]{titlegold}
            \Swatch[statblock triangles]{rulered}
            \Swatch{statblockoutline}
            \Swatch[top/bottom line (2014 only)]{statblockribbon}
            \Swatch{statblockbg}
            \Swatch[Basic Rules]{BrGreen}
            \Swatch[PHB Part 1]{PhbLightGreen}
            \Swatch[PHB Part 2]{PhbLightCyan}
            \Swatch[PHB Part 3]{PhbMauve}
            \Swatch[PHB Appendix]{PhbTan}
            \Swatch[DMG Part 1]{DmgLavender}
            \Swatch[DMG Part 2]{DmgCoral}
            \Swatch[DMG Part 3]{DmgSlateGray}
            \Swatch[DMG Appendix]{DmgLilac}

            The colors from BrGreen through DmgLilac are chosen so that, when set as the \texttt{themecolor} (using \cmdref{RpgSetThemeColor}), the appearance of the tables and sidebars is the same as the corresponding part in either the Basic Rules, the Players' Handbook, and the Dungeon Master's Guide.
        \subsection{Backgrounds \& Footers}

            The dnd theme uses a paper-like image as the background, and places a `scroll' on the footer\footnote{The scroll alternates direction in \texttt{twoside} documents; this document is written in oneside mode, so there is no alternating.}. The chapter name is placed in the footer (in \texttt{pagegold} color). The page number is positioned to lie in a divot of the scroll.

        \subsection{Text Boxes}

            The dnd theme modifies the text boxes to give them the following appearance:

            \begin{multicols}{3}
                
                \begin{RpgSidebar}{The RpgSidebar}
                   
                    Horizontal `ribbons' and sharp corners differentiate it from RpgTip.
                \end{RpgSidebar}
                
                \begin{RpgTip}{The RpgTip}
                    Almost entirely undecorated, with rounded corners.
                \end{RpgTip}

                \begin{RpgNarration}
                    RpgNarration has `bars' on the side.
                \end{RpgNarration}
            \end{multicols}



        \subsection{Section Headers}

               As in the default mode, only chapters\footnote{If in an rpgbook / other class which support chapters} are numbered; all other section/subsections (etc.) are unnumbered. 

                Chapters are rendered using a \cmd{RpgContour} (with the default colors). The subsection environment is embellished with a \cmd{hrule} (in the \texttt{titlegold} color) which stretches across the page.

              \begin{ExampleBlock}{Section Headers}
    \section*{Example} %starred so not added to toc; otherwise the same
    \subsection{Another Example}
    \subsubsection{More Examples!}
            \end{ExampleBlock}

        \subsection{RpgDice}\index{RpgDice}
            
            Following the syntax found in D\&D monster statblocks, RpgDice shows the average of the roll:
            \begin{ExampleBlock}{Dnd Dice}
            \RpgDice{3d8 -5 +2}
            \end{ExampleBlock}

    \newpage
    \section{RpgItem}\label{S:DndItem}

        \RpgMacro[RpgItem!Theme!dnd]{RpgItem}{\param{\paramO m \paramO}}{The dnd-specialisation of the \envref{RpgItem} environment, used to describe physical objects and equipment.}
        {
            \cmd{RpgItemShowCard\param{true/false}} \% set the card mode

            \cmd{begin}\param{RpgItem}[card-opts]\param{Item Name}[key-values]

            ~~<body text>

            \cmd{end}\param{RpgItem}

        }
        {As with all FeatureForge environments, RpgItem has the ability to switch between `text mode' and `card mode' depending on the value passed to \cmd{RpgItemShowCard} \RpgPage[p]{Macro:Rpg[X]ShowCard}. 
        
        The \texttt{dnd} theme defines the following keys for the RpgItem object:
        \begin{RpgTable}{llX}
            Key & Default Value & Effect
            \\
            rarity & \param{} & Common / Uncommon / Rare etc.
            \\
            type & \param{} & A descriptor such as `weapon' or `wondrous item'
            \\
             requires-attunement & \texttt{none} & Can either be used as a flag (i.e. a key with no value) in which case the phrase `Requires attunement' is added. If a value is assigned, it is appended immediately afterwards.
             \\
            image & \param{} & If non-empty, define an image path which is used when in card-mode.
        \end{RpgTable}}
    The card-variant  renders the title in a 'flag ribbon' which expands to fit the title (and shrinks the font size if it would spill over the card boundary)
    \begin{ExampleBlock}{Default RpgItem}
    \RpgItemShowCard{false}
    \begin{RpgItem}{Joyeuse}[
        rarity=Rare,
        type=weapon (sword),
        %just a flag, no value
        requires-attunement, 
        image={../example/img/joyeuse}
    ]
        The sword of Charlemagne; this jewelled sword gives you +3 to heroism checks.
    \end{RpgItem}

    \vspace{0.5cm}\hrule\vspace{0.5cm}

    %now the card version
    \RpgItemShowCard{true}
    \begin{RpgItem}{Joyeuse}[
        rarity=Rare,
        type=weapon (sword),
        %now add a value...
        requires-attunement={by a Paladin of France}, 
        image={../example/img/joyeuse}
    ]
        The sword of Charlemagne; this jewelled sword gives you +3 to heroism checks.
    \end{RpgItem}
    \end{ExampleBlock}
    
   

    
\section{RpgFeat}\label{S:DndFeat}\index{RpgFeat!Theme!default}

    \RpgMacro[RpgFeat!Theme!dnd]{RpgFeat}{\param{\paramO m \paramO}}{ The dnd-specialisation of the \envref{RpgFeat} environment, used to describe abilities and character features and choices.}
        {
            \cmd{RpgFeatShowCard\param{true/false}} \% set the card mode

            \cmd{begin}\param{RpgFeat}[card-opts]\param{Feat Name}[key-values]

            ~~<body text>

            \cmd{end}\param{RpgFeat}

        }
        {
        As with all FeatureForge environments, has the ability to switch between `text mode' and `card mode' depending on the value passed to \cmd{RpgFeatShowCard} \RpgPage[p]{Macro:Rpg[X]ShowCard}. The \texttt{dnd} RpgFeat is largely the same as the default, using the same `requires' key, and adding an alias:
            \begin{RpgTable}{llX}
                Key & Default Value & Effect
                \\
                requires & \param{} & If non-empty, an italicised note is added, indicating the prerequisites for acquiring the ability.
                \\
                prerequisite & \param{} & An alias for 'requires' (since this is what appears on screen).
            \end{RpgTable}
        }

        \def\grapplerText{  You've developed the skills necessary to hold your own in close--quarters grappling. You gain the following benefits:
     \begin{itemize}
       \item You have advantage on attack rolls against a creature you are grappling.
       \item You can use your action to try to pin a creature grappled by you. To do so, make another grapple check. If you succeed, you and the creature are both restrained until the grapple ends.
     \end{itemize}
}
     \begin{ExampleBlock}{Dnd RpgFeat}
    \RpgFeatShowCard{false}
    \begin{RpgFeat}{Grappler}[
         requires={Strength 13 or higher},
              ]
        \grapplerText %predefined to save space. Just plain text!
    \end{RpgFeat}

    \vspace{0.25cm}\hrule\vspace{0.25cm}

    %now the card version
    \RpgFeatShowCard{true}
    %demonstrate card-opts
    \begin{RpgFeat}[color=DmgLilac]{Grappler}[
        %%alias in action; could use 'requires' for same effect
         prerequisite={Strength 13 or higher},
            ]
       \grapplerText
    \end{RpgFeat}
    \end{ExampleBlock}
