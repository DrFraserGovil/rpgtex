#!/usr/bin/python3
import os

def findFile(file,fileList):
    if file in fileList:
        print("\t\tVerified",file)
    else:
        print("\n==========\nFATAL ERROR\n==========")
        print(f"Expected to find file {file}, but did not")
        print("Cannot verify integrity of rpgtex install. Configuration aborted")
        exit(1)
def verifyFiles(path):
    files = []
    for dirpath, dirnames, filenames in os.walk(path):
        files += filenames
    # print(files)
    
    print("\tVerifying package files")
    [findFile(target,files) for target in ["rpgtex.sty","rpgbook.cls","rpghandout.cls","map.tex","featureforge.sty"]]
    print("\tPackage integrity verified")


def getLocation():
    myLocation = os.path.split(os.path.split(__file__)[0])[0] #I am nested within scripts, so need to split twice to get rootdir
    
    print("\tLocated root directory: ",myLocation)
    verifyFiles(myLocation)
    return myLocation

def writeConfig(path):
    # Ensure path uses forward slashes for TeX
    outfile = os.path.join(path,"core","rpg-config.cfg")
    print("\tWriting configuration to file",outfile)
    texPath = path.replace("\\", "/")
    with open(outfile,"w") as f:
        f.write("% This file is generated by configure. DO NOT EDIT MANUALLY.\n")
        f.write("\edef\RpgPackagePath{" + texPath +"}\n")
if __name__ == "__main__":
    print("Configuring rpgtex install")
    loc = getLocation()
    writeConfig(loc)
    print("rpgtex configuration complete.")
    exit(0)
