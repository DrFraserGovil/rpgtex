%%% Sidebar
\ExplSyntaxOn
\tcbset{
  rpg sidebar/.style={
  before~upper     =
      {
        \bool_if:NT \l__rpg_layout_bool
          {
            \bool_if:NF \l__rpg_justified_bool
              {\RaggedRight}
          }
      },
    code={\linespread{.9}},
    frame~hidden,
    boxrule          = 0pt,
    enhanced,
    before~skip      = 13pt plus 4pt minus 4pt,
    toptitle         = 2pt,
    boxsep           = 3pt,
    left             = 6pt,
    right            = 6pt,
    top              = 0pt,
    bottom           = 2pt,
    fonttitle        = \RpgFontSidebarTitle,
    fontupper        = \RpgFontSidebarBody,
    fontlower        = \RpgFontSidebarBody,
    sharp~corners,
    parbox           = false,
    borderline~north = {1pt} {-0.5pt} {black},
    borderline~south = {1pt} {-0.5pt} {black},
    coltitle         = black,
    fuzzy~shadow     = {0mm} {-3.5pt} {-0.5pt} {0.4mm} {black!60!white},
    after~skip       = 14pt plus 4pt minus 4pt,
  }
}

%% narration

\tcbset{
  rpg narration/.style={
	    before~upper    =
      {
        \bool_if:NT \l__rpg_layout_bool
          {
            \bool_if:NF \l__rpg_justified_bool
              {\RaggedRight}
          }
      },
    code            = {\linespread {1.1} },
    enhanced~jigsaw,
    frame~hidden,
    boxrule         = 0pt,
    breakable,
    enhanced,
    before~skip     = 13pt plus 4pt minus 4pt,
    boxsep          = 8pt,
    top             = 0pt,
    left            = 0pt,
    right           = 0pt,
    bottom          = 0pt,
    sharp~corners,
    parbox          = false,
    fontupper       = \RpgFontNarration,
    fontlower       = \RpgFontNarration,
    after~skip      = 13pt plus 4pt minus 4pt,
  }
}

%% tip
\tcbset{
  rpg tip/.style={
	 before~upper =
      {
        \bool_if:NT \l__rpg_layout_bool
          {
            \bool_if:NF \l__rpg_justified_bool
              { \RaggedRight }
          }
      },
    code         = {\linespread{.9}},
    frame~hidden,
    boxrule      = 0pt,
    breakable,
    enhanced,
    before~skip  = 13pt plus 4pt minus 4pt,
    toptitle     = 2pt,
    boxsep       = 3pt,
    left         = 6pt,
    right        = 6pt,
    top          = 0pt,
    bottom       = 2pt,
    sharp~corners,
    fonttitle    = \RpgFontTipTitle,
    fontupper    = \RpgFontTipBody,
    fontlower    = \RpgFontTipBody,
    parbox       = false,
    coltitle     = black,
    after~skip   = 13pt plus 4pt minus 4pt,
	arc={2mm},
	rounded~corners,
  }
}
\ExplSyntaxOn
\bool_if:NT \l__rpg_layout_bool
{

  % Set spacing around floats
  \setlength{\textfloatsep}{11pt plus 4pt minus 4pt}
  \setlength{\intextsep}{11pt plus 4pt minus 4pt}
  \setlength{\dbltextfloatsep}{11pt plus 4pt minus 4pt}

  % Remove Numbering (If you want Numbering set secnumdepth to the appropriate depth)
  \setcounter{secnumdepth}{0}

  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  % Section formatting
  %%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
  % Part
  \titleformat {\part}
    [display]
    { \centering \RpgFontPart } % format
    { \RpgContour{\partname\ \thepart} } % label
    { 2ex } % sep
    { \RpgContour } % before-code

  % Chapter
  \titleformat {\chapter}
    { \RpgFontChapter } % format
    { \RpgContour{\chaptertitlename\ \thechapter :} } % label
    { \wordsep } % sep
    { \RpgContour } % before-code

  \titlespacing* {\chapter}
    { 0pt }  % left
    { .3ex }  % before-sep
    { 2.8ex } % after-sep

  % Section
  \titleformat {\section}
    { \RpgFontSection } % format
    { \thesection } % label
    { 1em } % sep
    { \nopagebreak } % before-code

  \titlespacing* { \section }
    { 0pt } % left
    { 3ex plus .43ex minus .43ex } % before-sep
    { 0pt } % after-sep

  % Subsection
  \titleformat {\subsection}
    { \RpgFontSubsection } % format
    { \thesubsection } % label
    { 1em } % sep
    { \nopagebreak } % before-code

  \titlespacing*{ \subsection }
    { 0pt } % left
    { 1.4ex plus .47ex minus .47ex } % before-sep
    { 1.2ex } % after-sep

  % Subsubsection
  \titleformat {\subsubsection}
    { \RpgFontSubsubsection } % format
    { \thesubsubsection } % label
    { 1em } % sep
    { \nopagebreak } % before-code

  \titlespacing* { \subsubsection }
    { 0pt } % left
  { 2ex plus .67ex minus .67ex } % before-sep
    { .2ex } % after-sep

  % Paragraph
  \titleformat {\paragraph} [runin]
    { \RpgFontParagraph } % format
    { \theparagraph \quad } % label
    {0pt} % sep
    {}    % before-code
    [.]   % after-code

  \titlespacing* {\paragraph}
    {0pt}      % left
    {\parskip} % before-sep
    {\wordsep} % after-sep

  % Subparagraph
  \titleformat {\subparagraph} [runin]
    { \RpgFontSubparagraph } % format
    { \thesubparagraph \quad } % label
    {0pt} % sep
    {}    % before-code
    [.]   % after-code

  \titlespacing* {\subparagraph}
    {\parindent} % left
    {\parskip}   % before-sep
    {\wordsep}   % after-sep
}

\ExplSyntaxOff
